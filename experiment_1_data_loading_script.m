% *************************************************************************
% Script to load all control patients' data for experiment 1, ready to run
% EM with multiple restarts to find parameters
% *************************************************************************

file_folder = 'C:\Users\Sam\OneDrive\C-PLACID\Eye Tracking Data\';
file_names = {'armgr.asc'; 'biged.asc'; 'briel.asc'; 'conma.asc';...
    'frani.asc'; 'golsh.asc'; 'grejo.asc'; 'holtr.asc'; 'lewwi.asc';...
    'manjo.asc'; 'mckro.asc'; 'medca.asc'; 'newal.asc'; 'pagjo.asc';...
    'pleri.asc'; 'redjo.asc'; 'strmi.asc'; 'staro.asc'; 'stegr.asc';...
    'towsu.asc'};
n_people = length(file_names);
[eye_tracking_data, target_data] = loadManyFiles(file_folder, file_names);
l_dirs = [[0; 1], [1; 1]./sqrt(2), [1; 0], [1; -1]./sqrt(2), [0; -1],...
    [-1; -1]./sqrt(2), [-1; 0], [-1; 1]./sqrt(2)];
orth_l_dirs = [l_dirs(:, 3:end), l_dirs(:, 1:2)];
fprintf('Transforming data for HMM...\n')
[y, zero_prob, u] =...
    hmmDataManyPeople(eye_tracking_data, target_data, l_dirs, orth_l_dirs);
epsilon = 0.001;
fprintf('Calculating conditional densities p(u | x)...\n')
p_ugx = condProbUX_ManyPeople(u, l_dirs, epsilon);
fprintf('Obtaining data for experiment 1 only...\n')
n_practice = 2;
n_experiments = 12;
exp_1_idx = 1 + arrayfun(@(exp_idx)...
    2 * (length(y{exp_idx}) == (n_practice + n_experiments)), 1:n_people);
y_exp1 = arrayfun(@(person_idx) y{person_idx}{exp_1_idx(person_idx)},...
    (1:n_people)', 'UniformOutput', false);
zero_prob_exp1 = arrayfun(@(person_idx)...
    zero_prob{person_idx}{exp_1_idx(person_idx)}, (1:n_people)',...
    'UniformOutput', false);
p_ugx_exp1 = arrayfun(@(person_idx)...
    p_ugx{person_idx}{exp_1_idx(person_idx)}, (1:n_people)',...
    'UniformOutput', false);